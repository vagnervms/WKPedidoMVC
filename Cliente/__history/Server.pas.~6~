unit Server;

interface

uses
  System.SysUtils, System.Classes, Data.DbxDatasnap, Data.DBXCommon,
  IPPeerClient, Data.SqlExpr, Data.DB, Datasnap.DBClient, Datasnap.DSConnect,
  Data.FMTBcd;

type
  TDMServer = class(TDataModule)
    DSPBanco: TDSProviderConnection;
    SQLCon: TSQLConnection;
  private
    { Private declarations }
  public
    { Public declarations }
    procedure AbrirDados(DataSet: TDataSet);
  end;

var
  DMServer: TDMServer;

implementation

{%CLASSGROUP 'Vcl.Controls.TControl'}

{$R *.dfm}

procedure TDMServer.AbrirDados(DataSet: TDataSet);
label 1;
var X: Byte;
begin
  if DataSet.Active then DataSet.Close;
1:try
    DataSet.Open;
  except
    DMServer.DSPBanco.Close;
    DMServer.DSPBanco.Open;
    Inc(X);
  end;
  if X < 4 then Goto 1 else
  begin
    raise Exception.Create('Realizada 3 tentativas sem conexão com o servidor');
  end;
end;

end.
